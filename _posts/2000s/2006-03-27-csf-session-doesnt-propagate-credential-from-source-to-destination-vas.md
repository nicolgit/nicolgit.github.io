---
title: CSF Session doesn't propagate credential from source to destination VAS
tags: [Connected Services Framework]
---
<DIV>If you don't include a "Persona Partecipant" in your session manifest, credentials aren't propagated from one VAS to another one. </DIV>
<DIV>Have a loook to the counting scenario you can find in sample CSF directory. The example call in sequence 2 VASes, each on these increment a value by 1, so if you submit 100, you receive 102 as result.</DIV>
<DIV>&nbsp;</DIV>
<DIV>This is the template manifest for the example:</DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face="Courier New" size=2>&lt;csfse:Session xmlns:xsd="</FONT><A href="http://www.w3.org/2001/XMLSchema"><FONT face="Courier New" size=2>http://www.w3.org/2001/XMLSchema</FONT></A><FONT face="Courier New" size=2>" xmlns:xsi="</FONT><A href="http://www.w3.org/2001/XMLSchema-instance"><FONT face="Courier New" size=2>http://www.w3.org/2001/XMLSchema-instance</FONT></A><FONT face="Courier New" size=2>" timestamp="2006-03-27T18:42:09.9344400+02:00" timeout="15" serialize="None" state="Active" routeAnyAction="true" ackOnRouteMsgToParticipants="false" xmlns:csfse="</FONT><A href="http://www.microsoft.com/csf/20/Session/"><FONT face="Courier New" size=2>http://www.microsoft.com/csf/20/Session/</FONT></A><FONT face="Courier New" size=2>"&gt;<BR>&nbsp;&lt;csfse:SessionName&gt;CountingSample&lt;/csfse:SessionName&gt;<BR>&nbsp;&lt;csfse:Participants&gt;<BR>&nbsp;&nbsp;&lt;csfse:Participant timeout="30" role="Service" mode="OneWay" type="WebService"&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantName&gt;ServiceParticipant1&lt;/csfse:ParticipantName&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantID&gt;ServiceParticipant1&lt;/csfse:ParticipantID&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantUrl&gt;http://CSF01/CountingService2/Service2.ashx&lt;/csfse:ParticipantUrl&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantWsdlUrl&gt;http://CSF01/CountingService2/Service2.ashx&lt;/csfse:ParticipantWsdlUrl&gt;<BR>&nbsp;&nbsp;&lt;/csfse:Participant&gt;<BR>&nbsp;&nbsp;&lt;csfse:Participant timeout="30" role="Service" mode="OneWay" type="WebService"&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantName&gt;ServiceParticipant2&lt;/csfse:ParticipantName&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantID&gt;ServiceParticipant2&lt;/csfse:ParticipantID&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantUrl&gt;http://CSF01/CountingService1/Service1.ashx&lt;/csfse:ParticipantUrl&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantWsdlUrl&gt;http://CSF01/CountingService1/Service1.ashx&lt;/csfse:ParticipantWsdlUrl&gt;<BR>&nbsp;&nbsp;&lt;/csfse:Participant&gt;<BR>&nbsp;&nbsp;&lt;csfse:Participant timeout="30" role="Service" mode="OneWay" type="WebService"&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantName&gt;UIParticipant&lt;/csfse:ParticipantName&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantID&gt;UIParticipant&lt;/csfse:ParticipantID&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantUrl&gt;soap.tcp://localhost:9111/UiFormService&lt;/csfse:ParticipantUrl&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:ParticipantWsdlUrl&gt;soap.tcp://localhost:9111/UiFormService&lt;/csfse:ParticipantWsdlUrl&gt;<BR>&nbsp;&nbsp;&lt;/csfse:Participant&gt;<BR>&nbsp;&lt;/csfse:Participants&gt;<BR>&nbsp;&lt;csfse:RoutingTable version="1" timestamp="2006-03-27T18:42:13.9603020+02:00"&gt;<BR>&nbsp;&nbsp;&lt;csfse:Routes&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:Route&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Criteria&gt;(ACTION EQ 'Add')&lt;/csfse:Criteria&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Destination&gt;ServiceParticipant1[Add]&lt;/csfse:Destination&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Intercept/&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;/csfse:Route&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:Route&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Criteria&gt;((ACTION EQ 'AddResponse') AND (SOURCE EQ 'ServiceParticipant2'))&lt;/csfse:Criteria&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Destination&gt;UIParticipant[RouteResponse]&lt;/csfse:Destination&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Intercept/&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;/csfse:Route&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;csfse:Route&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Criteria&gt;((ACTION EQ 'AddResponse') AND (SOURCE EQ 'ServiceParticipant1'))&lt;/csfse:Criteria&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Destination&gt;ServiceParticipant2[Add]&lt;/csfse:Destination&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&lt;csfse:Intercept/&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;/csfse:Route&gt;<BR>&nbsp;&nbsp;&lt;/csfse:Routes&gt;<BR>&nbsp;&lt;/csfse:RoutingTable&gt;<BR>&lt;/csfse:Session&gt;</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV>Everything starts with a message with an "Add" action from UI partecipant. <BR>The SOAP header is something like (some header removed to simplify the reading):</DIV>
<DIV>&nbsp;</DIV>
<DIV>&nbsp;<FONT face="Courier New" size=2> &lt;soap:Envelope&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;soap:Header&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;csfse:SessionID&gt;urn:...&lt;/csfse:SessionID&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsa:Action&gt;Add&lt;/wsa:Action&gt;<BR>&nbsp;...<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsse:Security soap:mustUnderstand="1"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsu:Timestamp wsu:Id="Timestamp-9f6829b8-d2d3-49c5-9c7c-60c026998a57"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsu:Created&gt;2006-03-27T16:51:38Z&lt;/wsu:Created&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsu:Expires&gt;2006-03-27T16:56:38Z&lt;/wsu:Expires&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/wsu:Timestamp&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <FONT style="BACKGROUND-COLOR: #ff0000">&lt;wsse:UsernameToken wsu:Id="SecurityToken-..."&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsse:Username&gt;administrator@fabrikam.com&lt;/wsse:Username&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsse:Password&gt;password&lt;/wsse:Password&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsse:Nonce&gt;VOlNA2DOTUoFuWOjfW8lvg==&lt;/wsse:Nonce&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsu:Created&gt;2006-03-27T16:51:38Z&lt;/wsu:Created&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/wsse:UsernameToken&gt;<BR></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/wsse:Security&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;/soap:Header&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;soap:Body&gt;<BR>...<BR>&nbsp;&nbsp;&nbsp; &lt;/soap:Body&gt;<BR>&nbsp; &lt;/soap:Envelope&gt;</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV>When session routes this message to ServicePartecipant1 the header becomes:</DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face="Courier New" size=2>&nbsp; &lt;soap:Envelope&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;soap:Header&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp; &lt;csfse:SessionID&gt;urn:...&lt;/csfse:SessionID&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsa:Action&gt;Add&lt;/wsa:Action&gt;<BR>&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsse:Security&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsu:Timestamp wsu:Id="Timestamp-f97709ea-9a36-4a3c-9c27-301e655c404a"&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsu:Created&gt;2006-03-27T16:51:38Z&lt;/wsu:Created&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;wsu:Expires&gt;2006-03-27T16:56:38Z&lt;/wsu:Expires&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/wsu:Timestamp&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/wsse:Security&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;/soap:Header&gt;<BR>&nbsp;&nbsp;&nbsp; &lt;soap:Body&gt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<BR>&nbsp;&nbsp;&nbsp; &lt;/soap:Body&gt;<BR>&nbsp; &lt;/soap:Envelope&gt;</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV>as you can see the username token is gone. If you want to keep it, modify template manifest as follows:</DIV>
<DIV>&nbsp;</DIV>
<DIV>(1) add persona partecipant</DIV>
<DIV>&nbsp;</DIV>
<DIV><FONT face="Courier New" size=2>&lt;csfse:Participant timeout="30" role="Persona" mode="OneWay" type="WebService"&gt;<BR>&nbsp;&lt;csfse:ParticipantName&gt;PersonaParticipant&lt;/csfse:ParticipantName&gt;<BR>&nbsp;&lt;csfse:ParticipantID&gt;PersonaParticipant&lt;/csfse:ParticipantID&gt;<BR>&nbsp;&lt;csfse:ParticipantUrl&gt;...&lt;/csfse:ParticipantUrl&gt;<BR>&nbsp;&lt;csfse:ParticipantWsdlUrl&gt;...&lt;/csfse:ParticipantWsdlUrl&gt;<BR>&nbsp;&lt;csfse:SecurityToken&gt;<BR>&nbsp;&nbsp;&lt;wsse:UsernameToken wsu:Id="SecurityToken-055ed3fb-b592-49c7-b2b7-6f18a1ff7a86"&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;wsse:Username&gt;administrator@fabrikam.com&lt;/wsse:Username&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;wsse:Password Type="</FONT><FONT face="Courier New" size=2>http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText"&gt;...&lt;/wsse:Password</FONT><FONT face="Courier New" size=2>&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;wsse:Nonce&gt;wPasvF7+DZ2DTcuWfEKVsg==&lt;/wsse:Nonce&gt;<BR>&nbsp;&nbsp;&nbsp;&lt;wsu:Created&gt;2006-03-24T17:07:19Z&lt;/wsu:Created&gt;<BR>&nbsp;&nbsp;&lt;/wsse:UsernameToken&gt;<BR>&nbsp;&lt;/csfse:SecurityToken&gt;<BR>&lt;/csfse:Participant&gt;</FONT></DIV>
<DIV>&nbsp;</DIV>
<DIV>(2) For any participant except for the Persona participant, the &lt;policyDocument&gt; tag indicates that secondary credentials are required for the participant. If a &lt;policyDocument&gt; tag is specified for a participant, then a&nbsp; Session Persona &lt;Participant&gt; should also be defined. Warning: <STRONG>If you specify the &lt;policyDocument&gt; without a persona partecipant, the message is simply not ruoted!!!</STRONG><BR></DIV>
